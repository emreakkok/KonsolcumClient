<div class="container my-4" *ngIf="!isLoading">
  <!-- Breadcrumb -->
  <div class="row mb-4">
    <div class="col-12">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-2">
          <li class="breadcrumb-item">
            <a [routerLink]="['/']" class="text-decoration-none text-warning">Ana Sayfa</a>
          </li>
          <li class="breadcrumb-item">
            <a [routerLink]="['/products']" class="text-decoration-none text-warning">Ürünler</a>
          </li>
          <li class="breadcrumb-item">
            <a [routerLink]="['/categories', product.categoryId, 'products']" 
               class="text-decoration-none text-warning">{{ product.categoryName }}</a>
          </li>
          <li class="breadcrumb-item active" aria-current="page">{{ product.name }}</li>
        </ol>
      </nav>
    </div>
  </div>

  <!-- Product Detail -->
  <div class="row">
    <!-- Image Gallery -->
    <div class="col-lg-6 col-md-6 mb-4">
      <div class="product-gallery">
        <!-- Main Image -->
        <div class="main-image-container position-relative">
          <img 
            [src]="product.images.length > 0 ? getImageUrl(product.images[currentImageIndex].path) : getImageUrl(product.showcaseImagePath || '')"
            (error)="onImageError($event)"
            [alt]="product.name"
            class="main-image img-fluid rounded shadow"
            style="width: 100%; height: 400px; object-fit: cover;">
          
          <!-- Navigation Arrows -->
          <button 
            *ngIf="product.images.length > 1"
            class="btn btn-dark btn-sm position-absolute top-50 start-0 translate-middle-y ms-2 opacity-75"
            (click)="previousImage()"
            style="z-index: 10;">
            <i class="fas fa-chevron-left"></i>
          </button>
          
          <button 
            *ngIf="product.images.length > 1"
            class="btn btn-dark btn-sm position-absolute top-50 end-0 translate-middle-y me-2 opacity-75"
            (click)="nextImage()"
            style="z-index: 10;">
            <i class="fas fa-chevron-right"></i>
          </button>

          <!-- Image Counter -->
          <div 
            *ngIf="product.images.length > 1"
            class="position-absolute bottom-0 end-0 bg-dark bg-opacity-75 text-white px-2 py-1 rounded-top-start small">
            {{ currentImageIndex + 1 }} / {{ product.images.length }}
          </div>

          <!-- Product Badges -->
          <div class="position-absolute top-0 start-0 m-3">
            <span *ngIf="product.isFeatured" class="badge bg-warning text-dark mb-2 d-block">
              <i class="fas fa-star me-1"></i>Öne Çıkan
            </span>
            <span *ngIf="product.stockQuantity <= 0" class="badge bg-danger">
              <i class="fas fa-times-circle me-1"></i>Stokta Yok
            </span>
            <span *ngIf="product.stockQuantity > 0 && product.stockQuantity <= 5" class="badge bg-warning text-dark">
              <i class="fas fa-exclamation-triangle me-1"></i>Az Stok
            </span>
          </div>
        </div>

        <!-- Thumbnail Images -->
        <div *ngIf="product.images.length > 1" class="thumbnail-container mt-3">
          <div class="row g-2">
            <div 
              *ngFor="let image of product.images; let i = index" 
              class="col-2"
              [class.active-thumbnail]="i === currentImageIndex">
              <img 
                [src]="getImageUrl(image.path)"
                (error)="onImageError($event)"
                [alt]="product.name"
                class="thumbnail-image img-fluid rounded cursor-pointer border"
                [class.border-warning]="i === currentImageIndex"
                [class.border-2]="i === currentImageIndex"
                style="width: 100%; height: 60px; object-fit: cover;"
                (click)="goToImage(i)">
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Product Info -->
    <div class="col-lg-6 col-md-6">
      <div class="product-info">
        <!-- Product Title -->
        <h1 class="product-title h2 text-dark fw-bold mb-3">{{ product.name }}</h1>
        
        <!-- Product Category -->
        <div class="mb-3">
          <span class="text-muted">Kategori: </span>
          <a [routerLink]="['/categories', product.categoryId, 'products']" 
             class="text-warning text-decoration-none fw-semibold">
            {{ product.categoryName }}
          </a>
        </div>

        <!-- Product Price -->
        <div class="price-section mb-4">
          <div class="current-price">
            <span class="h3 text-success fw-bold">
              {{ product.price | currency:'TRY':'symbol':'1.2-2':'tr-TR' }}
            </span>
          </div>
        </div>

        <!-- Quantity and Add to Cart -->
        <div *ngIf="product.stockQuantity > 0" class="quantity-cart-section mb-4">
          <div class="row g-3 align-items-center">
            <!-- Quantity Selector -->
            <div class="col-md-4">
              <label class="form-label text-muted small">Miktar</label>
              <div class="input-group">
                <button 
                  class="btn btn-outline-secondary"
                  type="button"
                  (click)="decreaseQuantity()"
                  [disabled]="quantity <= 1">
                  <i class="fas fa-minus"></i>
                </button>
                <input 
                  type="number" 
                  class="form-control text-center"
                  [min]="1"
                  [max]="product.stockQuantity"
                  [value]="quantity"
                  (input)="onQuantityChange($event)"
                  readonly>
                <button 
                  class="btn btn-outline-secondary"
                  type="button"
                  (click)="increaseQuantity()"
                  [disabled]="quantity >= product.stockQuantity">
                  <i class="fas fa-plus"></i>
                </button>
              </div>
            </div>

            <!-- Add to Cart Button -->
            <div class="col-md-8">
              <label class="form-label text-muted small d-block">&nbsp;</label>
              <button 
                class="btn btn-success btn-lg w-100"
                (click)="addToBasket()"
                [disabled]="product.stockQuantity <= 0">
                <i class="fas fa-shopping-cart me-2"></i>
                Sepete Ekle
              </button>
            </div>
          </div>
        </div>

        <!-- Out of Stock Message -->
        <div *ngIf="product.stockQuantity <= 0" class="alert alert-danger mb-4">
          <i class="fas fa-exclamation-triangle me-2"></i>
          Bu ürün şu anda stokta bulunmamaktadır.
        </div>

        <!-- Product Description -->
        <div class="product-description">
          <h5 class="mb-3">Ürün Açıklaması</h5>
          <div class="description-text overflow-auto" style="max-height: 200px;">
            <p class="text-muted lh-lg mb-0">{{ product.description }}</p>
          </div>
        </div>

        <!-- Product Meta Info -->
        <div class="product-meta mt-4">
          <div class="row g-3">
            <div class="col-6">
              <small class="text-muted d-block">Ürün Kodu</small>
              <span class="fw-semibold">{{ product.id | slice:0:8 | uppercase }}</span>
            </div>
            <div class="col-6">
              <small class="text-muted d-block">Eklenme Tarihi</small>
              <span class="fw-semibold">{{ product.createdDate | date:'dd.MM.yyyy' }}</span>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons mt-4">
          <div class="row g-2">
            <div class="col-4">
              <button class="btn btn-outline-secondary w-100" (click)="goBack()">
                <i class="fas fa-arrow-left me-1"></i>Geri
              </button>
            </div>
            <div class="col-4">
              <button class="btn btn-outline-warning w-100" (click)="goToCategory()">
                <i class="fas fa-th-large me-1"></i>Kategori
              </button>
            </div>
            <div class="col-4">
              <button class="btn btn-outline-warning w-100" (click)="goToProducts()">
                <i class="fas fa-cube me-1"></i>Ürünler
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading State -->
<div class="container my-5" *ngIf="isLoading">
  <div class="row">
    <div class="col-12 text-center py-5">
      <div class="spinner-border text-warning" role="status">
        <span class="visually-hidden">Yükleniyor...</span>
      </div>
      <p class="mt-3 text-muted">Ürün detayları yükleniyor...</p>
    </div>
  </div>
</div>